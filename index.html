<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>parquet-wasm - v0.7.0</title><meta name="description" content="Documentation for parquet-wasm"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">parquet-wasm - v0.7.0</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>parquet-wasm - v0.7.0</h1></div><div class="tsd-panel tsd-typography"><a id="md:wasm-parquet-npm-version" class="tsd-anchor"></a><h1 class="tsd-anchor-link">WASM Parquet <a href="https://www.npmjs.com/package/parquet-wasm" target="_blank" class="external"><img src="https://img.shields.io/npm/v/parquet-wasm.svg" alt="npm version"></a><a href="#md:wasm-parquet-npm-version" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>WebAssembly bindings to read and write the <a href="https://parquet.apache.org/" target="_blank" class="external">Apache Parquet</a> format to and from <a href="https://arrow.apache.org/" target="_blank" class="external">Apache Arrow</a> using the Rust <a href="https://crates.io/crates/parquet" target="_blank" class="external"><code>parquet</code></a> and <a href="https://crates.io/crates/arrow" target="_blank" class="external"><code>arrow</code></a> crates.</p>
<p>This is designed to be used alongside a JavaScript Arrow implementation, such as the canonical <a href="https://arrow.apache.org/docs/js/" target="_blank" class="external">JS Arrow library</a>.</p>
<p>Including read and write support and all compression codecs, the brotli-compressed WASM bundle is 1.2 MB. Refer to <a href="#md:custom-builds">custom builds</a> for how to build a smaller bundle. A minimal read-only bundle without compression support can be as small as 456 KB brotli-compressed.</p>
<a id="md:install" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Install<a href="#md:install" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>parquet-wasm</code> is published to NPM. Install with</p>
<pre><code><span class="hl-0">yarn add parquet</span><span class="hl-1">-</span><span class="hl-0">wasm</span>
</code><button>Copy</button></pre>

<p>or</p>
<pre><code><span class="hl-0">npm install parquet</span><span class="hl-1">-</span><span class="hl-0">wasm</span>
</code><button>Copy</button></pre>

<a id="md:api" class="tsd-anchor"></a><h2 class="tsd-anchor-link">API<a href="#md:api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Parquet-wasm has both a synchronous and asynchronous API. The sync API is simpler but requires fetching the entire Parquet buffer in advance, which is often prohibitive.</p>
<a id="md:sync-api" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Sync API<a href="#md:sync-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Refer to these functions:</p>
<ul>
<li><a href="https://kylebarron.dev/parquet-wasm/functions/esm_parquet_wasm.readParquet.html" target="_blank" class="external"><code>readParquet</code></a>: Read a Parquet file synchronously.</li>
<li><a href="https://kylebarron.dev/parquet-wasm/functions/esm_parquet_wasm.readSchema.html" target="_blank" class="external"><code>readSchema</code></a>: Read an Arrow schema from a Parquet file synchronously.</li>
<li><a href="https://kylebarron.dev/parquet-wasm/functions/esm_parquet_wasm.writeParquet.html" target="_blank" class="external"><code>writeParquet</code></a>: Write a Parquet file synchronously.</li>
</ul>
<a id="md:async-api" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Async API<a href="#md:async-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><a href="https://kylebarron.dev/parquet-wasm/functions/esm_parquet_wasm.readParquetStream.html" target="_blank" class="external"><code>readParquetStream</code></a>: Create a <a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream" target="_blank" class="external">ReadableStream</a> that emits Arrow RecordBatches from a Parquet file.</li>
<li><a href="https://kylebarron.dev/parquet-wasm/classes/esm_parquet_wasm.ParquetFile.html" target="_blank" class="external"><code>ParquetFile</code></a>: A class for reading portions of a remote Parquet file. Use <a href="https://kylebarron.dev/parquet-wasm/classes/esm_parquet_wasm.ParquetFile.html#fromUrl" target="_blank" class="external"><code>fromUrl</code></a> to construct from a remote URL or <a href="https://kylebarron.dev/parquet-wasm/classes/esm_parquet_wasm.ParquetFile.html#fromFile" target="_blank" class="external"><code>fromFile</code></a> to construct from a <a href="https://developer.mozilla.org/en-US/docs/Web/API/File" target="_blank" class="external"><code>File</code></a> handle. Note that when you're done using this class, you'll need to call <a href="https://kylebarron.dev/parquet-wasm/classes/esm_parquet_wasm.ParquetFile.html#free" target="_blank" class="external"><code>free</code></a> to release any memory held by the ParquetFile instance itself.</li>
</ul>
<p>Both sync and async functions return or accept a <a href="https://kylebarron.dev/parquet-wasm/classes/bundler_parquet_wasm.Table.html" target="_blank" class="external"><code>Table</code></a> class, an Arrow table in WebAssembly memory. Refer to its documentation for moving data into/out of WebAssembly.</p>
<a id="md:entry-points" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Entry Points<a href="#md:entry-points" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Entry point</th>
<th>Description</th>
<th>Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>parquet-wasm</code>, <code>parquet-wasm/esm</code>, or <code>parquet-wasm/esm/parquet_wasm.js</code></td>
<td>ESM, to be used directly from the Web as an ES Module</td>
<td><a href="https://kylebarron.dev/parquet-wasm/modules/esm_parquet_wasm.html" target="_blank" class="external">Link</a></td>
</tr>
<tr>
<td><code>parquet-wasm/bundler</code></td>
<td>&quot;Bundler&quot; build, to be used in bundlers such as Webpack</td>
<td><a href="https://kylebarron.dev/parquet-wasm/modules/bundler_parquet_wasm.html" target="_blank" class="external">Link</a></td>
</tr>
<tr>
<td><code>parquet-wasm/node</code></td>
<td>Node build, to be used with synchronous <code>require</code> in NodeJS</td>
<td><a href="https://kylebarron.dev/parquet-wasm/modules/node_parquet_wasm.html" target="_blank" class="external">Link</a></td>
</tr>
</tbody>
</table>
<a id="md:esm" class="tsd-anchor"></a><h3 class="tsd-anchor-link">ESM<a href="#md:esm" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>esm</code> entry point is the primary entry point. It is the default export from <code>parquet-wasm</code>, and is also accessible at <code>parquet-wasm/esm</code> and <code>parquet-wasm/esm/parquet_wasm.js</code> (for symmetric imports <a href="#md:using-directly-from-a-browser">directly from a browser</a>).</p>
<p><strong>Note that when using the <code>esm</code> bundles, you must manually initialize the WebAssembly module before using any APIs</strong>. Otherwise, you'll get an error <code>TypeError: Cannot read properties of undefined</code>. There are multiple ways to initialize the WebAssembly code:</p>
<a id="md:asynchronous-initialization" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Asynchronous initialization<a href="#md:asynchronous-initialization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The primary way to initialize is by awaiting the default export.</p>
<pre><code class="js"><span class="hl-1">import</span><span class="hl-0"> wasmInit, {readParquet} </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&quot;parquet-wasm&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-3">wasmInit</span><span class="hl-0">();</span>
</code><button type="button">Copy</button></pre>

<p>Without any parameter, this will try to fetch a file named <code>'parquet_wasm_bg.wasm'</code> at the same location as <code>parquet-wasm</code>. (E.g. this snippet <code>input = new URL('parquet_wasm_bg.wasm', import.meta.url);</code>).</p>
<p>Note that you can also pass in a custom URL if you want to host the <code>.wasm</code> file on your own servers.</p>
<pre><code class="js"><span class="hl-1">import</span><span class="hl-0"> wasmInit, {readParquet} </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&quot;parquet-wasm&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-4">// Update this version to match the version you&#39;re using.</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">wasmUrl</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-2">&quot;https://cdn.jsdelivr.net/npm/parquet-wasm@0.6.1/esm/parquet_wasm_bg.wasm&quot;</span><span class="hl-0">;</span><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-3">wasmInit</span><span class="hl-0">(wasmUrl);</span>
</code><button type="button">Copy</button></pre>

<a id="md:synchronous-initialization" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Synchronous initialization<a href="#md:synchronous-initialization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The <code>initSync</code> named export allows for</p>
<pre><code class="js"><span class="hl-1">import</span><span class="hl-0"> {initSync, readParquet} </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&quot;parquet-wasm&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-4">// The contents of esm/parquet_wasm_bg.wasm in an ArrayBuffer</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">wasmBuffer</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-3">ArrayBuffer</span><span class="hl-0">(</span><span class="hl-1">...</span><span class="hl-0">);</span><br/><br/><span class="hl-4">// Initialize the Wasm synchronously</span><br/><span class="hl-3">initSync</span><span class="hl-0">(wasmBuffer)</span>
</code><button type="button">Copy</button></pre>

<p>Async initialization should be preferred over downloading the Wasm buffer and then initializing it synchronously, as <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/JavaScript_interface/instantiateStreaming_static" target="_blank" class="external"><code>WebAssembly.instantiateStreaming</code></a> is the most efficient way to both download and initialize Wasm code.</p>
<a id="md:bundler" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Bundler<a href="#md:bundler" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>bundler</code> entry point doesn't require manual initialization of the WebAssembly blob, but needs setup with whatever bundler you're using. <a href="https://rustwasm.github.io/docs/wasm-bindgen/reference/deployment.html#bundlers" target="_blank" class="external">Refer to the Rust Wasm documentation for more info</a>.</p>
<a id="md:node" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Node<a href="#md:node" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>node</code> entry point can be loaded synchronously from Node.</p>
<pre><code class="js"><span class="hl-1">const</span><span class="hl-0"> {</span><span class="hl-5">readParquet</span><span class="hl-0">} </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-3">require</span><span class="hl-0">(</span><span class="hl-2">&quot;parquet-wasm&quot;</span><span class="hl-0">);</span><br/><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">wasmTable</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-3">readParquet</span><span class="hl-0">(</span><span class="hl-1">...</span><span class="hl-0">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:using-directly-from-a-browser" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using directly from a browser<a href="#md:using-directly-from-a-browser" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>You can load the <code>esm/parquet_wasm.js</code> file directly from a CDN</p>
<pre><code class="js"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">parquet</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-3">import</span><span class="hl-0">(</span><br/><span class="hl-0">  </span><span class="hl-2">&quot;https://cdn.jsdelivr.net/npm/parquet-wasm@0.6.1/esm/+esm&quot;</span><br/><span class="hl-0">)</span><br/><span class="hl-1">await</span><span class="hl-0"> parquet.</span><span class="hl-3">default</span><span class="hl-0">();</span><br/><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">wasmTable</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> parquet.</span><span class="hl-3">readParquet</span><span class="hl-0">(</span><span class="hl-1">...</span><span class="hl-0">);</span>
</code><button type="button">Copy</button></pre>

<p>This specific endpoint will minify the ESM before you receive it.</p>
<a id="md:debug-functions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Debug functions<a href="#md:debug-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>These functions are not present in normal builds to cut down on bundle size. To create a custom build, see <a href="#md:custom-builds">Custom Builds</a> below.</p>
<a id="md:setpanichook" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><code>setPanicHook</code><a href="#md:setpanichook" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p><code>setPanicHook(): void</code></p>
<p>Sets <a href="https://github.com/rustwasm/console_error_panic_hook" target="_blank" class="external"><code>console_error_panic_hook</code></a> in Rust, which provides better debugging of panics by having more informative <code>console.error</code> messages. Initialize this first if you're getting errors such as <code>RuntimeError: Unreachable executed</code>.</p>
<p>The WASM bundle must be compiled with the <code>console_error_panic_hook</code> feature for this function to exist.</p>
<a id="md:example" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Example<a href="#md:example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="js"><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-5">*</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> arrow </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&quot;apache-arrow&quot;</span><span class="hl-0">;</span><br/><span class="hl-1">import</span><span class="hl-0"> initWasm, {</span><br/><span class="hl-0">  Compression,</span><br/><span class="hl-0">  readParquet,</span><br/><span class="hl-0">  Table,</span><br/><span class="hl-0">  writeParquet,</span><br/><span class="hl-0">  WriterPropertiesBuilder,</span><br/><span class="hl-0">} </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&quot;parquet-wasm&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-4">// Instantiate the WebAssembly context</span><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-3">initWasm</span><span class="hl-0">();</span><br/><br/><span class="hl-4">// Create Arrow Table in JS</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">LENGTH</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-5">2000</span><span class="hl-0">;</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">rainAmounts</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> Float32Array.</span><span class="hl-3">from</span><span class="hl-0">({ length: </span><span class="hl-5">LENGTH</span><span class="hl-0"> }, () </span><span class="hl-1">=&gt;</span><br/><span class="hl-0">  </span><span class="hl-3">Number</span><span class="hl-0">((Math.</span><span class="hl-3">random</span><span class="hl-0">() </span><span class="hl-1">*</span><span class="hl-0"> </span><span class="hl-5">20</span><span class="hl-0">).</span><span class="hl-3">toFixed</span><span class="hl-0">(</span><span class="hl-5">1</span><span class="hl-0">))</span><br/><span class="hl-0">);</span><br/><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">rainDates</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> Array.</span><span class="hl-3">from</span><span class="hl-0">(</span><br/><span class="hl-0">  { length: </span><span class="hl-5">LENGTH</span><span class="hl-0"> },</span><br/><span class="hl-0">  (</span><span class="hl-6">_</span><span class="hl-0">, </span><span class="hl-6">i</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-3">Date</span><span class="hl-0">(Date.</span><span class="hl-3">now</span><span class="hl-0">() </span><span class="hl-1">-</span><span class="hl-0"> </span><span class="hl-5">1000</span><span class="hl-0"> </span><span class="hl-1">*</span><span class="hl-0"> </span><span class="hl-5">60</span><span class="hl-0"> </span><span class="hl-1">*</span><span class="hl-0"> </span><span class="hl-5">60</span><span class="hl-0"> </span><span class="hl-1">*</span><span class="hl-0"> </span><span class="hl-5">24</span><span class="hl-0"> </span><span class="hl-1">*</span><span class="hl-0"> i)</span><br/><span class="hl-0">);</span><br/><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">rainfall</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> arrow.</span><span class="hl-3">tableFromArrays</span><span class="hl-0">({</span><br/><span class="hl-0">  precipitation: rainAmounts,</span><br/><span class="hl-0">  date: rainDates,</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-4">// Write Arrow Table to Parquet</span><br/><br/><span class="hl-4">// wasmTable is an Arrow table in WebAssembly memory</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">wasmTable</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> Table.</span><span class="hl-3">fromIPCStream</span><span class="hl-0">(arrow.</span><span class="hl-3">tableToIPC</span><span class="hl-0">(rainfall, </span><span class="hl-2">&quot;stream&quot;</span><span class="hl-0">));</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">writerProperties</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-3">WriterPropertiesBuilder</span><span class="hl-0">()</span><br/><span class="hl-0">  .</span><span class="hl-3">setCompression</span><span class="hl-0">(Compression.</span><span class="hl-5">ZSTD</span><span class="hl-0">)</span><br/><span class="hl-0">  .</span><span class="hl-3">build</span><span class="hl-0">();</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">parquetUint8Array</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-3">writeParquet</span><span class="hl-0">(wasmTable, writerProperties);</span><br/><br/><span class="hl-4">// Read Parquet buffer back to Arrow Table</span><br/><span class="hl-4">// arrowWasmTable is an Arrow table in WebAssembly memory</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">arrowWasmTable</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-3">readParquet</span><span class="hl-0">(parquetUint8Array);</span><br/><br/><span class="hl-4">// table is now an Arrow table in JS memory</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">table</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> arrow.</span><span class="hl-3">tableFromIPC</span><span class="hl-0">(arrowWasmTable.</span><span class="hl-3">intoIPCStream</span><span class="hl-0">());</span><br/><span class="hl-0">console.</span><span class="hl-3">log</span><span class="hl-0">(table.schema.</span><span class="hl-3">toString</span><span class="hl-0">());</span><br/><span class="hl-4">// Schema&lt;{ 0: precipitation: Float32, 1: date: Date64&lt;MILLISECOND&gt; }&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="md:published-examples" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Published examples<a href="#md:published-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>(These may use older versions of the library with a different API).</p>
<ul>
<li><a href="https://observablehq.com/@kylebarron/geoparquet-on-the-web" target="_blank" class="external">GeoParquet on the Web (Observable)</a></li>
<li><a href="https://observablehq.com/@bmschmidt/hello-parquet-wasm" target="_blank" class="external">Hello, Parquet-WASM (Observable)</a></li>
</ul>
<a id="md:comparison-to-hyparquet" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Comparison to <a href="https://github.com/hyparam/hyparquet" target="_blank" class="external"><code>hyparquet</code></a><a href="#md:comparison-to-hyparquet" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>hyparquet</code> is another Parquet reader for JavaScript. That project is written in pure JavaScript and has subtly different goals and comparing it to <code>parquet-wasm</code> provides benefits and costs.</p>
<a id="md:advantages-of-hyparquet" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Advantages of <code>hyparquet</code>:<a href="#md:advantages-of-hyparquet" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Smaller bundle size</li>
<li>Pure JS, so easier to debug</li>
<li>No WebAssembly, so no initialization step</li>
<li>No WebAssembly, so no separate memory space.</li>
</ul>
<a id="md:advantages-of-parquet-wasm" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Advantages of <code>parquet-wasm</code>:<a href="#md:advantages-of-parquet-wasm" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Faster for large files, as it uses a very high-performance Rust Parquet library compiled to WebAssembly</li>
<li>Faster and more memory efficient because it loads data into Apache Arrow, a high-performance binary memory format. In comparison, hyparquet loads data to JS objects, which are <em>much</em> less memory efficient than Arrow buffers. This is especially true for large files.</li>
<li>Even though <code>parquet-wasm</code> has a larger bundle size, the bandwidth savings of loading large amounts of Parquet can quickly make up for that overhead.</li>
</ul>
<a id="md:conclusion" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Conclusion<a href="#md:conclusion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>
<p>If you only need to load the <em>metadata</em> of Parquet files, or if you have <em>very small</em> Parquet files, using hyparquet could be a good choice as hyparquet is smaller, and thus the overhead before loading the file could be smaller.</p>
</li>
<li>
<p>If you need the <em>absolute smallest</em> bundle size, hyparquet may be better for your use case.</p>
</li>
<li>
<p>Otherwise, since <code>parquet-wasm</code>:</p>
<ol>
<li>Uses a really high performance Rust library</li>
<li>Is running in WebAssembly, and</li>
<li>Converts to a high-performance binary memory format</li>
</ol>
<p>If you have large files and can use the resulting Arrow data directly without converting to JS objects, <code>parquet-wasm</code> should be significantly faster and more memory efficient.</p>
</li>
</ul>
<p>Feel free to open an issue to discuss more!</p>
<a id="md:performance-considerations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance considerations<a href="#md:performance-considerations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Tl;dr: When you have a <code>Table</code> object (resulting from <code>readParquet</code>), try the new
<a href="https://kylebarron.dev/parquet-wasm/classes/esm_parquet_wasm.Table.html#intoFFI" target="_blank" class="external"><code>Table.intoFFI</code></a>
API to move it to JavaScript memory. This API is less well tested than the <a href="https://kylebarron.dev/parquet-wasm/classes/esm_parquet_wasm.Table.html#intoIPCStream" target="_blank" class="external"><code>Table.intoIPCStream</code></a> API, but should be
faster and have <strong>much</strong> less memory overhead (by a factor of 2). If you hit any bugs, please
<a href="https://github.com/kylebarron/parquet-wasm/issues/new" target="_blank" class="external">create a reproducible issue</a>.</p>
<p>Under the hood, <code>parquet-wasm</code> first decodes a Parquet file into Arrow <em>in WebAssembly memory</em>. But
then that WebAssembly memory needs to be copied into JavaScript for use by Arrow JS. The &quot;normal&quot;
conversion APIs (e.g. <code>Table.intoIPCStream</code>) use the <a href="https://arrow.apache.org/docs/python/ipc.html" target="_blank" class="external">Arrow IPC
format</a> to get the data back to JavaScript. But this
requires another memory copy <em>inside WebAssembly</em> to assemble the various arrays into a single
buffer to be copied back to JS.</p>
<p>Instead, the new <code>Table.intoFFI</code> API uses Arrow's <a href="https://arrow.apache.org/docs/format/CDataInterface.html" target="_blank" class="external">C Data
Interface</a> to be able to copy or view
Arrow arrays from within WebAssembly memory without any serialization.</p>
<p>Note that this approach uses the <a href="https://github.com/kylebarron/arrow-js-ffi" target="_blank" class="external"><code>arrow-js-ffi</code></a>
library to parse the Arrow C Data Interface definitions. This library has not yet been tested in
production, so it may have bugs!</p>
<p>I wrote an <a href="https://observablehq.com/@kylebarron/zero-copy-apache-arrow-with-webassembly" target="_blank" class="external">interactive blog
post</a> on this approach
and the Arrow C Data Interface if you want to read more!</p>
<a id="md:example-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example<a href="#md:example-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="js"><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-5">*</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> arrow </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&quot;apache-arrow&quot;</span><span class="hl-0">;</span><br/><span class="hl-1">import</span><span class="hl-0"> { parseTable } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&quot;arrow-js-ffi&quot;</span><span class="hl-0">;</span><br/><span class="hl-1">import</span><span class="hl-0"> initWasm, { wasmMemory, readParquet } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&quot;parquet-wasm&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-4">// Instantiate the WebAssembly context</span><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-3">initWasm</span><span class="hl-0">();</span><br/><br/><span class="hl-4">// A reference to the WebAssembly memory object.</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">WASM_MEMORY</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-3">wasmMemory</span><span class="hl-0">();</span><br/><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">resp</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-3">fetch</span><span class="hl-0">(</span><span class="hl-2">&quot;https://example.com/file.parquet&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">parquetUint8Array</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-3">Uint8Array</span><span class="hl-0">(</span><span class="hl-1">await</span><span class="hl-0"> resp.</span><span class="hl-3">arrayBuffer</span><span class="hl-0">());</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">wasmArrowTable</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-3">readParquet</span><span class="hl-0">(parquetUint8Array).</span><span class="hl-3">intoFFI</span><span class="hl-0">();</span><br/><br/><span class="hl-4">// Arrow JS table that was directly copied from Wasm memory</span><br/><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">table</span><span class="hl-1">:</span><span class="hl-0"> </span><span class="hl-3">arrow</span><span class="hl-0">.</span><span class="hl-3">Table</span><span class="hl-0"> </span><span class="hl-1">=</span><span class="hl-0"> </span><span class="hl-3">parseTable</span><span class="hl-0">(</span><br/><span class="hl-0">  </span><span class="hl-5">WASM_MEMORY</span><span class="hl-0">.buffer,</span><br/><span class="hl-0">  wasmArrowTable.</span><span class="hl-3">arrayAddrs</span><span class="hl-0">(),</span><br/><span class="hl-0">  wasmArrowTable.</span><span class="hl-3">schemaAddr</span><span class="hl-0">()</span><br/><span class="hl-0">);</span><br/><br/><span class="hl-4">// VERY IMPORTANT! You must call `drop` on the Wasm table object when you&#39;re done using it</span><br/><span class="hl-4">// to release the Wasm memory.</span><br/><span class="hl-4">// Note that any access to the pointers in this table is undefined behavior after this call.</span><br/><span class="hl-4">// Calling any `wasmArrowTable` method will error.</span><br/><span class="hl-0">wasmArrowTable.</span><span class="hl-3">drop</span><span class="hl-0">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:compression-support" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Compression support<a href="#md:compression-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Parquet specification permits several compression codecs. This library currently supports:</p>
<ul>
<li>[x] Uncompressed</li>
<li>[x] Snappy</li>
<li>[x] Gzip</li>
<li>[x] Brotli</li>
<li>[x] ZSTD</li>
<li>[x] LZ4_RAW</li>
<li>[ ] LZ4 (deprecated)</li>
</ul>
<p>LZ4 support in Parquet is a bit messy. As described <a href="https://github.com/apache/parquet-format/blob/54e53e5d7794d383529dd30746378f19a12afd58/Compression.md" target="_blank" class="external">here</a>, there are <em>two</em> LZ4 compression options in Parquet (as of version 2.9.0). The original version <code>LZ4</code> is now deprecated; it used an undocumented framing scheme which made interoperability difficult. The specification now reads:</p>
<blockquote>
<p>It is strongly suggested that implementors of Parquet writers deprecate this compression codec in their user-facing APIs, and advise users to switch to the newer, interoperable <code>LZ4_RAW</code> codec.</p>
</blockquote>
<p>It's currently unknown how widespread the ecosystem support is for <code>LZ4_RAW</code>. As of <code>pyarrow</code> v7, it now writes <code>LZ4_RAW</code> by default and presumably has read support for it as well.</p>
<a id="md:custom-builds" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Custom builds<a href="#md:custom-builds" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>In some cases, you may know ahead of time that your Parquet files will only include a single compression codec, say Snappy, or even no compression at all. In these cases, you may want to create a custom build of <code>parquet-wasm</code> to keep bundle size at a minimum. If you install the Rust toolchain and <code>wasm-pack</code> (see <a href="DEVELOP.md">Development</a>), you can create a custom build with only the compression codecs you require.</p>
<p>The minimum supported Rust version in this project is 1.60. To upgrade your toolchain, use <code>rustup update stable</code>.</p>
<a id="md:example-custom-builds" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Example custom builds<a href="#md:example-custom-builds" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Reader-only bundle with Snappy compression:</p>
<pre><code><span class="hl-0">wasm</span><span class="hl-1">-</span><span class="hl-0">pack build </span><span class="hl-1">--</span><span class="hl-0">no</span><span class="hl-1">-default-</span><span class="hl-0">features </span><span class="hl-1">--</span><span class="hl-0">features snappy </span><span class="hl-1">--</span><span class="hl-0">features reader</span>
</code><button>Copy</button></pre>

<p>Writer-only bundle with no compression support, targeting Node:</p>
<pre><code><span class="hl-0">wasm</span><span class="hl-1">-</span><span class="hl-0">pack build </span><span class="hl-1">--</span><span class="hl-0">target nodejs </span><span class="hl-1">--</span><span class="hl-0">no</span><span class="hl-1">-default-</span><span class="hl-0">features </span><span class="hl-1">--</span><span class="hl-0">features writer</span>
</code><button>Copy</button></pre>

<p>Bundle with reader and writer support, targeting Node, using <code>arrow</code> and <code>parquet</code> crates with all their supported compressions, with <code>console_error_panic_hook</code> enabled:</p>
<pre><code class="bash"><span class="hl-3">wasm-pack</span><span class="hl-0"> </span><span class="hl-2">build</span><span class="hl-0"> </span><span class="hl-5">\</span><br/><span class="hl-0">  </span><span class="hl-5">--target</span><span class="hl-0"> </span><span class="hl-2">nodejs</span><span class="hl-0"> </span><span class="hl-5">\</span><br/><span class="hl-0">  </span><span class="hl-5">--no-default-features</span><span class="hl-0"> </span><span class="hl-5">\</span><br/><span class="hl-0">  </span><span class="hl-5">--features</span><span class="hl-0"> </span><span class="hl-2">reader</span><span class="hl-0"> </span><span class="hl-5">\</span><br/><span class="hl-0">  </span><span class="hl-5">--features</span><span class="hl-0"> </span><span class="hl-2">writer</span><span class="hl-0"> </span><span class="hl-5">\</span><br/><span class="hl-0">  </span><span class="hl-5">--features</span><span class="hl-0"> </span><span class="hl-2">all_compressions</span><span class="hl-0"> </span><span class="hl-5">\</span><br/><span class="hl-0">  </span><span class="hl-5">--features</span><span class="hl-0"> </span><span class="hl-2">debug</span><br/><span class="hl-4"># Or, given the fact that the default feature includes several of these features, a shorter version:</span><br/><span class="hl-3">wasm-pack</span><span class="hl-0"> </span><span class="hl-2">build</span><span class="hl-0"> </span><span class="hl-5">--target</span><span class="hl-0"> </span><span class="hl-2">nodejs</span><span class="hl-0"> </span><span class="hl-5">--features</span><span class="hl-0"> </span><span class="hl-2">debug</span>
</code><button type="button">Copy</button></pre>

<p>Refer to the <a href="https://rustwasm.github.io/docs/wasm-pack/commands/build.html" target="_blank" class="external"><code>wasm-pack</code> documentation</a> for more info on flags such as <code>--release</code>, <code>--dev</code>, <code>target</code>, and to the <a href="https://doc.rust-lang.org/cargo/reference/features.html" target="_blank" class="external">Cargo documentation</a> for more info on how to use features.</p>
<a id="md:available-features" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Available features<a href="#md:available-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>By default, <code>all_compressions</code>, <code>reader</code>, <code>writer</code>, and <code>async</code> features are enabled. Use <code>--no-default-features</code> to remove these defaults.</p>
<ul>
<li><code>reader</code>: Activate read support.</li>
<li><code>writer</code>: Activate write support.</li>
<li><code>async</code>: Activate asynchronous read support.</li>
<li><code>all_compressions</code>: Activate all supported compressions.</li>
<li><code>brotli</code>: Activate Brotli compression.</li>
<li><code>gzip</code>: Activate Gzip compression.</li>
<li><code>snappy</code>: Activate Snappy compression.</li>
<li><code>zstd</code>: Activate ZSTD compression.</li>
<li><code>lz4</code>: Activate LZ4_RAW compression.</li>
<li><code>debug</code>: Expose the <code>setPanicHook</code> function for better error messages for Rust panics.</li>
</ul>
<a id="md:node-20" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Node &lt;20<a href="#md:node-20" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>On Node versions before 20, you'll have to <a href="https://docs.rs/getrandom/latest/getrandom/#nodejs-es-module-support" target="_blank" class="external">polyfill the Web Cryptography API</a>.</p>
<a id="md:future-work" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Future work<a href="#md:future-work" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>[ ] Example of pushdown predicate filtering, to download only chunks that match a specific condition</li>
<li>[ ] Column filtering, to download only certain columns</li>
<li>[ ] More tests</li>
</ul>
<a id="md:acknowledgements" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Acknowledgements<a href="#md:acknowledgements" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>A starting point of my work came from @my-liminal-space's <a href="https://github.com/my-liminal-space/read-parquet-browser" target="_blank" class="external"><code>read-parquet-browser</code></a> (which is also dual licensed MIT and Apache 2).</p>
<p>@domoritz's <a href="https://github.com/domoritz/arrow-wasm" target="_blank" class="external"><code>arrow-wasm</code></a> was a very helpful reference for bootstrapping Rust-WASM bindings.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:wasm-parquet-npm-version"><span>WASM <wbr/>Parquet npm version</span></a><ul><li><a href="#md:install"><span>Install</span></a></li><li><a href="#md:api"><span>API</span></a></li><li><ul><li><a href="#md:sync-api"><span>Sync API</span></a></li><li><a href="#md:async-api"><span>Async API</span></a></li></ul></li><li><a href="#md:entry-points"><span>Entry <wbr/>Points</span></a></li><li><ul><li><a href="#md:esm"><span>ESM</span></a></li><li><ul><li><a href="#md:asynchronous-initialization"><span>Asynchronous initialization</span></a></li><li><a href="#md:synchronous-initialization"><span>Synchronous initialization</span></a></li></ul></li><li><a href="#md:bundler"><span>Bundler</span></a></li><li><a href="#md:node"><span>Node</span></a></li><li><a href="#md:using-directly-from-a-browser"><span>Using directly from a browser</span></a></li><li><a href="#md:debug-functions"><span>Debug functions</span></a></li><li><ul><li><a href="#md:setpanichook"><span>set<wbr/>Panic<wbr/>Hook</span></a></li></ul></li></ul></li><li><a href="#md:example"><span>Example</span></a></li><li><ul><li><a href="#md:published-examples"><span>Published examples</span></a></li></ul></li><li><a href="#md:comparison-to-hyparquet"><span>Comparison to hyparquet</span></a></li><li><ul><li><a href="#md:advantages-of-hyparquet"><span>Advantages of hyparquet:</span></a></li><li><a href="#md:advantages-of-parquet-wasm"><span>Advantages of parquet-<wbr/>wasm:</span></a></li><li><a href="#md:conclusion"><span>Conclusion</span></a></li></ul></li><li><a href="#md:performance-considerations"><span>Performance considerations</span></a></li><li><ul><li><a href="#md:example-1"><span>Example</span></a></li></ul></li><li><a href="#md:compression-support"><span>Compression support</span></a></li><li><a href="#md:custom-builds"><span>Custom builds</span></a></li><li><ul><li><a href="#md:example-custom-builds"><span>Example custom builds</span></a></li><li><a href="#md:available-features"><span>Available features</span></a></li></ul></li><li><a href="#md:node-20"><span>Node &lt;20</span></a></li><li><a href="#md:future-work"><span>Future work</span></a></li><li><a href="#md:acknowledgements"><span>Acknowledgements</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>parquet-wasm - v0.7.0</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
